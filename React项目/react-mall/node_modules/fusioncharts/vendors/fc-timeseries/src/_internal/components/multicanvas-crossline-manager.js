import{SmartRenderer}from'../../../../fc-core/src/component-interface';import{convertColor}from'../../../../fc-core/src/lib/lib-graphics';import{pluckNumber,defined}from'../../../../fc-core/src/lib';import isValidNumber from'../../../../fc-utils/src/type/is-valid-number';function getHorizontalMarkerSupport(a){return!('column'!==a&&'continuous'!==a)}const isPlotStackable=a=>'column'===a,xShift=5;class CrosslineManager extends SmartRenderer{constructor(){super();let a,b,c,d,e,f,g,h,i,j,k,l,m,n=this;n.canvases=[],n._handler=function(o){h=n.config.multiCanvasTooltip,a=o.sender.getLinkedParent(),i=a.config.xConfigs[0].scale,j=i.getDomain(),m=a.isWithinCanvas(o.data.chartX,o.data.chartY);let p,q,r,s,t,u,v,w,x,y=o.data.hoveredInfo,z=y.hovered?y.pointIndex:y.binIndexHovered;m&&y.pointObj?(u=y.pointObj.startDate,v=y.pointObj.endDate,k=y.pointObj.paddingInTimestamp||0,c=i.getDomainValue((i.getRangeValue(u)+i.getRangeValue(v))/2),(+c<+j[0]-k||+c>+j[1]+k)&&(c=void 0)):c=z=void 0,n.canvases.forEach(d=>{e=d===a,g=d.getTranslation(),x=void 0,p=d.getChildren('verticalCrossLine')[0],p.setData({value:c,showMarker:e,dateRange:{startDate:u,endDate:v}},!0),r=d.getChildren('dataset'),(!isPlotStackable(r[0].getName())||1===r.length)&&+c?r.forEach(a=>{a.setHoverInEffect(z,y.hovered&&y.component===a),defined(l)&&l!==z&&a.setHoverOutEffect(l)}):!m&&r.forEach(a=>{a.setHoverOutEffect(y.binIndexHovered)}),h&&!e&&(s=d.getChildren('tooltipHover')[0],t=s.config,f='',b=d.getFromEnv('toolTipController'),m?(r.forEach(a=>{'visible'===a.config.visibility&&a.config.dataInfo[z]&&(x=a.config.dataInfo[z],f+=a._getTooltext(!1,!1,z))}),x?(f=r[0]._getDateForToolText(z)+f,''===f?b.hide(t.currentToolTip):t.currentToolTip=b.drawAt(x.x+(x.width||0)/2+xShift+g.x,(x.colY||x.y)+g.y,f,t.currentToolTip)):b.hide(t.currentToolTip)):b.hide(t.currentToolTip))}),l=z,q=a.getChildren('horizontalCrossLine')[0],y.hovered&&m?(w=isValidNumber(y.pointObj.yBaseValue)?0<=y.pointObj.yBaseValue?y.pointObj.value:y.pointObj.yBaseValue:y.pointObj.value,d=y.component.config,q.setData({value:w,showMarker:getHorizontalMarkerSupport(y.component.getName()),text:y.pointObj.value,markerFill:convertColor(d.plotColor||d.strokeColor||d.fillColor)},!0)):q.setData({value:void 0},!0)}}__setDefaultConfig(){super.__setDefaultConfig(),this.config.defaultFormat='%A, %b %d, %Y'}configure(){super.configure();let a,b,c,d=this,e=d.getLinkedParent(),f=e.config.focusPanels.length;for(d.config.multiCanvasTooltip=pluckNumber(d.getFromEnv('chart-attrib').multicanvastooltip,1),c=0;c<f;c++)b=e.getChildren(`canvas_${c}`)[0],d.canvases.push(b),a=b.getFromEnv('mouseTracker'),d.addExtEventListener('canvasHovered',d._handler,a)}}export default CrosslineManager;
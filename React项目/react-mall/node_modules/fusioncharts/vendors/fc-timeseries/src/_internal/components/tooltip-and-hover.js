import SmartRenderer from'../../../../fc-core/src/component-interface/smart-renderer';import{pluckNumber}from'../../../../fc-core/src/lib';let MOUSEOVER='fc-mouseover',MOUSEDOWN='fc-mousedown',MOUSEUP='fc-mouseup',MOUSEMOVE='fc-mousemove',MOUSEOUT='fc-mouseout',CLICK='fc-click',xShift=5;class MouseAction extends SmartRenderer{configure(){super.configure();let a=this,b=a.config,c=a.getFromEnv('chart-attrib'),d=a.getFromEnv('mouseTracker');b.showTooltip=pluckNumber(c.showtooltip,1),b.eventAdded||a.addExtEventListener('canvasHovered',function(a){return b.eventAdded=!0,function(){switch(arguments[1].hoveredInfo.component&&arguments[1].hoveredInfo.component.getType()){case'timeMarker':a._triggerMarkerMouseActions(...arguments);break;default:a._triggerMouseActions(...arguments);}}}(a),d)}mouseoutHandler(a,b,c,d){var e=this,f=e.config;d&&d.config&&(d.setHoverOutEffect(c),d._firePlotEvent&&d._firePlotEvent(MOUSEOUT,c,a)),f.showTooltip&&e.getFromEnv('toolTipController').hide(f.currentToolTip),delete f._lastDatasetIndex,delete f._lastPointIndex}_triggerMarkerMouseActions(a){let b,c,d=this,e=a.data,f=d.getFromEnv('toolTipController'),g=e.chartX,h=e.chartY,i=d.getLinkedParent(),j=i.getTranslation(),k=e.hoveredInfo,l=k.hovered,m=d.config,n=m.showTooltip,o=k.component,p=k.pointObj.hoveredMarkerDim,q=k.hovered&&o.getToolTextConfiguration(p.toolTextArr),r=i.isWithinCanvas(g,h-(k.thresholdY||0));l&&r?(b=g,c=p.y-q.dimensions.height+j.y,n&&(m.currentToolTip=f.drawAt(b,c,q.toolText,m.currentToolTip)),o.setHoverInEffect(k.pointIndex,k.pointObj.index,!1)):(n&&f.hide(m.currentToolTip),o.setHoverOutEffect())}_triggerMouseActions(a){var b,c,d,f,g,h,i,k=this,m=a.data,n=k.getFromEnv('toolTipController'),o=m.i,p=m.e,e=m.chartX,q=m.chartY,r=m.hoveredInfo,s=0<=o,t=k.getLinkedParent(),u=t.getChild(void 0,'dataset'),v=k.config,w=v._lastDatasetIndex,x=v._lastPointIndex,y=t.getTranslation(),z='',A=r&&r.pointIndex,B=t.isWithinCanvas(e,q);if(s&&(r.datasetIndex=o,i=k.getMouseEvents(p,r.datasetIndex,A,r.component.getName(),r.markerObj)),(!B||(!s||i&&i.fireOut)&&'undefined'!=typeof w)&&(i&&!i.events.length?v.mouseoutTimer=setTimeout(function(){k.mouseoutHandler(p,w,x,v._lastComponentHovered)},20):(k.mouseoutHandler(p,w,x,v._lastComponentHovered),clearTimeout(v.mouseoutTimer))),B&&u.length&&v.showTooltip&&(u.forEach((a,b)=>{'visible'===a.config.visibility&&(z+=a._getTooltext(s,o===b,s?A:r.binIndexHovered),a.config.dataInfo[r.binIndexHovered]&&(f=a.config.dataInfo[r.binIndexHovered],h=a))}),z=(h?h._getDateForToolText(s?A:r.binIndexHovered):'')+z,b=s?r.pointObj:f,b?''===z?n.hide(v.currentToolTip):v.currentToolTip=n.drawAt(b.x+(b.width||0)/2+xShift+y.x,(b.colY||b.y)+y.y,z,v.currentToolTip):n.hide(v.currentToolTip)),s&&(c=i.events&&i.events.length,c))for(v._lastDatasetIndex=r.datasetIndex,v._lastPointIndex=A,g=v._lastComponentHovered=r.component,v._lastComponentHoveredName=g&&g.getName(),g.setHoverInEffect(A),v.showTooltip&&'dataMarker'===g.getType()&&(z=g._getTooltext(A),v.currentToolTip=n.draw(p,z,v.currentToolTip)),d=0;d<c;d+=1)g&&g._firePlotEvent&&g&&g._firePlotEvent&&g._firePlotEvent(i.events[d],A,p,r)}getMouseEvents(a,b,c,d){var e=this,f=e.config,g=f._lastDatasetIndex,h=f._lastPointIndex,i=f._lastComponentHoveredName,j=a.type,k={fireOut:!1,events:[]};return j===CLICK?k.events.push(CLICK):j===MOUSEMOVE?i===d&&g===b&&h===c?(clearTimeout(f.mouseoutTimer),k.events.push(MOUSEMOVE)):(k.events.push(MOUSEOVER),k.fireOut=!0):j===MOUSEDOWN?((i!==d||g!==b||h!==c)&&(k.fireOut=!0,k.events.push(MOUSEOVER)),k.events.push(MOUSEDOWN)):j===MOUSEOVER?i===d&&g===b&&h===c?clearTimeout(f.mouseoutTimer):(k.fireOut=!0,k.events.push(MOUSEOVER)):j===MOUSEUP?k.events.push(MOUSEUP):j===MOUSEOUT?k.fireOut=!0:void 0,k}}export default MouseAction;
import{SmartRenderer}from'../../../../../fc-core/src/component-interface';import Calendar from'../../../vendors/fc-calendar/dist/fc-calendar';import{PXSTRING}from'../../../../../fc-core/src/lib';import DateBox from'./date-box';import TimeBox from'./time-box';import Button from'./button';const DEFAULT_CALENDAR_GAP=25,DEFAULT_VERTICAL_PADDING=8,DEFAULT_HORIZONTAL_PADDING=5,formatDate=a=>(10>a?'0'+a:a)+'',isWithinDate=(a,b,c)=>{var d=new Date(b.year,b.month,b.day),e=new Date(c.year,c.month,c.day),f=new Date(a.year,a.month,a.day);return!!(+f>=+d&&+f<=+e)};class CustomRangeManager extends SmartRenderer{__setDefaultConfig(){let a=this.config;a.marginLeft=10,a.marginRight=10,a.marginTop=15,a.marginBottom=15,a.contextStart={year:1970,month:1,day:1},a.contextEnd={year:2070,month:1,day:1},this._calendars={}}configureAttributes(a={}){let b=this,c=b.config;Object.keys(a).forEach(b=>c[b]=a[b]),b.attachChild(DateBox,'left-date','left-date').configure({label:'From: ',date:c.startDate,id:'left'}),b.attachChild(DateBox,'right-date','right-date').configure({label:'To: ',date:c.endDate,id:'right'}),c.showTime&&(b.attachChild(TimeBox,'left-time','left-time').configure({time:c.startDate}),b.attachChild(TimeBox,'right-time','right-time').configure({time:c.endDate})),b.attachChild(Button,'apply','apply').configure({label:'Apply',type:'submit',style:{color:'#ffffff',"font-style":'11px !important'}}),b.attachChild(Button,'cancel','cancel').configure({label:'Cancel',type:'cancel',style:{backgroundColor:'#ffffff',color:'#7A7A7A',border:'0px',"font-style":'11px !important'}})}manageSpace(){let a,b,c,d,e=this,f=e.config,g=e.getChildren('left-date')[0],h=e.getChildren('right-date')[0],i=e.getChildren('left-time'),j=e.getChildren('right-time'),k=e.getChildren('apply')[0],l=e.getChildren('cancel')[0],m=4,n={height:0,width:0};d={height:191,width:163},i&&(i=i[0],n=i.getDimension()),j&&(j=j[0],j.getDimension()),n.height||(m=2),a=g.getDimension(),b=h.getDimension(),c=k.getDimension(),l.getDimension(),f.leftCalendarPosition={x:f.marginLeft,y:f.marginTop+a.height+DEFAULT_VERTICAL_PADDING},f.rightCalendarPosition={x:f.marginLeft+d.width+DEFAULT_CALENDAR_GAP,y:f.marginTop+b.height+DEFAULT_VERTICAL_PADDING},g.setTranslation(f.marginLeft,f.marginTop),h.setTranslation(f.marginLeft+d.width+DEFAULT_CALENDAR_GAP,f.marginTop),i&&i.setTranslation(f.marginLeft,f.leftCalendarPosition.y+d.height+16),j&&j.setTranslation(f.marginLeft+d.width+DEFAULT_CALENDAR_GAP,f.rightCalendarPosition.y+d.height+16),k.setTranslation(f.marginLeft,f.leftCalendarPosition.y+d.height+m*DEFAULT_VERTICAL_PADDING+n.height),l.setTranslation(f.marginLeft+c.width+DEFAULT_HORIZONTAL_PADDING,f.leftCalendarPosition.y+d.height+m*DEFAULT_VERTICAL_PADDING+n.height),f.width=f.rightCalendarPosition.x+d.width+f.marginRight,f.height=f.leftCalendarPosition.y+d.height+c.height+m*DEFAULT_VERTICAL_PADDING+n.height+f.marginBottom}draw(){this.manageSpace();let a=this,b=a.getLinkedParent(),c=a.config,d=b.config.containerPos;a.addGraphicalElement({el:'html',attr:{x:d.x-c.width/2,y:d.y+4,width:c.width,height:c.height,type:'div',fill:'ffffff',display:'block',stroke:'ff0000',strokeWidth:10,visibility:c.visibility},css:{fontSize:11+PXSTRING,fontFamily:'Verdana,sans-serif',border:'1px solid #cdcdcd'},component:a,label:'box-container',id:'box-container'}),a.addGraphicalElement({el:'html',attr:{x:c.width/2-10,y:-9,width:15,height:15,type:'div',fill:'ffffff',display:'block',stroke:'ff0000',strokeWidth:10,visibility:c.visibility},css:{fontSize:11+PXSTRING,fontFamily:'Verdana,sans-serif',"border-left":'1px solid #cdcdcd',"border-right":'0px solid #cdcdcd',"border-top":'1px solid #cdcdcd',"border-bottom":'0px solid #cdcdcd',transform:'rotate(45deg)'},container:{label:'box-container',id:'box-container'},component:a,label:'box-pointer',id:'box-pointer'}),c.drawCalendars&&a.drawCalendars()}getCalendars(){return this._calendars}drawCalendars(){let a=this,b=a.config,c=a.getCalendars(),d=b.leftCalendarPosition,e=b.rightCalendarPosition,f=a.getGraphicalElement('box-container','box-container').element;c.left?c.left.configure({weekLabel:['S','M','T','W','T','F','S'],selectedDate:b.startDate,posX:d.x,posY:d.y,rangeStart:b.contextStart,rangeEnd:b.contextEnd,showInactiveMonths:!0,container:f}):c.left=new Calendar({weekLabel:['S','M','T','W','T','F','S'],selectedDate:b.startDate,posX:d.x,posY:d.y,container:f,rangeStart:b.contextStart,rangeEnd:b.contextEnd,showInactiveMonths:!0,events:{onDateChange:function(b){a.updateDate(b,'left')},onMonthChange:function(b){a.updateDate(b,'left')},onYearChange:function(b){a.updateDate(b,'left')}}}),c.right?c.right.configure({weekLabel:['S','M','T','W','T','F','S'],selectedDate:b.endDate,posX:e.x,posY:e.y,rangeStart:b.contextStart,rangeEnd:b.contextEnd,showInactiveMonths:!0,container:f}):c.right=new Calendar({weekLabel:['S','M','T','W','T','F','S'],selectedDate:b.endDate,posX:e.x,posY:e.y,rangeStart:b.contextStart,rangeEnd:b.contextEnd,showInactiveMonths:!0,container:f,events:{onDateChange:function(b){a.updateDate(b,'right')},onMonthChange:function(b){a.updateDate(b,'right')},onYearChange:function(b){a.updateDate(b,'right')}}})}updateDate(a,b){let c=this,d=c.getChildren(b+'-date')[0],e=d.getGraphicalElement('box','box');d.configure({date:a}),e.element.value=`${formatDate(a.day)}/${formatDate(a.month)}/${formatDate(a.year)}`}updateCalendar(a,b){let c=this,d=c.config,e=c.getCalendars();isWithinDate(a,d.contextStart,d.contextEnd)?e[b].configure({selectedDate:a}):c.getChildren(b+'-date')[0].setData({},!0)}submitData(a='cancel'){let b=this,c=b.getLinkedParent(),d=c.getFromEnv('chart'),e=[],f=b.getCalendars(),g=f.left.getDate(),h=f.right.getDate(),i=b.getChildren('left-time'),j=b.getChildren('right-time'),k={hours:0,minutes:0,seconds:0},l={hours:0,minutes:0,seconds:0};i&&(k=i[0].getTime()),j&&(l=j[0].getTime()),'submit'===a?(e.push(+new Date(g.year,g.month-1,g.day,k.hours,k.minutes,k.seconds)),e.push(+new Date(h.year,h.month-1,h.day,l.hours,l.minutes,l.seconds)),d.setFocusLimit(e)):this.getLinkedParent().setData({},!0)}}export{formatDate};export default CustomRangeManager;
{"ast":null,"code":"import _classCallCheck from \"F:\\\\App Store\\\\Coding\\\\Github_Download\\\\JS-\\\\React\\u9879\\u76EE\\\\react-mall\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"F:\\\\App Store\\\\Coding\\\\Github_Download\\\\JS-\\\\React\\u9879\\u76EE\\\\react-mall\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport { UNDEF, UNDERSCORE, isInterActiveEvt } from '../lib';\nimport { triggerEvent, removeListener, getListeners, addListener } from '../event-api';\nimport schedular, { priorityList } from '../schedular';\n\nvar idCounterStore = {},\n    asyncDrawOptions = {\n  executionDelay: 16\n},\n    _mapSubFnBackward = function _mapSubFnBackward(a, b) {\n  if (a && a.hasOwnProperty && b && b.call) {\n    var c, d, e;\n\n    for (c in a) {\n      if (a.hasOwnProperty(c)) if (d = a[c], d instanceof Array) for (e = d.length - 1; 0 <= e; e--) {\n        b(d[e], c, e);\n      } else b(d, c);\n    }\n  }\n},\n    _mapSubFnForward = function _mapSubFnForward(a, b) {\n  if (a && a.hasOwnProperty && b && b.call) {\n    var c, d, e, f;\n\n    for (c in a) {\n      if (a.hasOwnProperty(c)) if (d = a[c], d instanceof Array) for (f = d.length, e = 0; e < f; e++) {\n        b(d[e], c, e);\n      } else b(d, c);\n    }\n  }\n},\n    addAllEventsOnGraphic = function addAllEventsOnGraphic(a, b, c) {\n  var d, e;\n  if (b && b.hasOwnProperty) for (d in b) {\n    b.hasOwnProperty(d) && (e = getListeners(d, c), e && 1 <= e.length && a && a.on(d, b[d]));\n  }\n},\n    removeAllEventsFromGraphic = function removeAllEventsFromGraphic(a, b) {\n  var c, d;\n  if (b && b.hasOwnProperty) for (c in b) {\n    b.hasOwnProperty(c) && (d = getListeners(c, this), d && 1 <= d.length && a && a.off(c, b[c]));\n  }\n};\n\nvar ComponentBase =\n/*#__PURE__*/\nfunction () {\n  function ComponentBase() {\n    _classCallCheck(this, ComponentBase);\n\n    var a = this;\n    a.config = {}, a._jobList = {}, a._env = {}, a._extListeners = {}, a._state = {}, a._factories = [], a._factoriyNames = {}, a._graphics = {}, a.__drawJob = function () {\n      a.updateVisual();\n    }, a.__remove = function () {\n      a.getState('removed') && a._dispose();\n    }, a._setRemoveAnim = function (b, c) {\n      var d = a.getFromEnv('animationManager');\n      d.setAnimation({\n        el: b,\n        component: a,\n        label: c,\n        props: b.__props\n      }), a._setRemoveAnim = function (b, c) {\n        d.setAnimation({\n          el: b,\n          component: a,\n          label: c,\n          props: b.__props\n        });\n      };\n    }, a.__instantRemoveFn = function (b) {\n      var c = a.getFromEnv('animationManager');\n      c.removeElement(b, !0), a.__instantRemoveFn = function (a) {\n        return c.removeElement(a, !0);\n      };\n    };\n  }\n\n  _createClass(ComponentBase, [{\n    key: \"configure\",\n    value: function configure(a) {\n      this.preConfigure(a), this.configureAttributes(a), this.postConfigure(a), this.invokeFactories();\n    }\n  }, {\n    key: \"preConfigure\",\n    value: function preConfigure(a) {\n      this.fireEvent('preconfigure', a);\n    }\n  }, {\n    key: \"configureAttributes\",\n    value: function configureAttributes() {\n      return this;\n    }\n  }, {\n    key: \"postConfigure\",\n    value: function postConfigure(a) {\n      this.fireEvent('postconfigure', a);\n    }\n  }, {\n    key: \"prepareAttributes\",\n    value: function prepareAttributes() {\n      var a = this;\n      a.fireEvent('beforeattributeprepared'), a.allocatePosition && a.allocatePosition(), a._mapChildren(function (a) {\n        a.prepareAttributes && a.prepareAttributes();\n      }), a.fireEvent('attributeprepared');\n    }\n  }, {\n    key: \"setDefaults\",\n    value: function setDefaults() {\n      this.__setDefaultConfig(), this._mapChildren(function (a) {\n        return a.setDefaults();\n      });\n    }\n  }, {\n    key: \"__setDefaultConfig\",\n    value: function __setDefaultConfig() {\n      return this;\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(a) {\n      var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n      var c,\n          d = this,\n          e = d.getLinkedParent();\n      d.asyncDraw(), b || this.setDefaults(), d.configure && d.configure(a), c = d.getState('change-info'), c && c.hasNoExternalEffect || e && e.childChange && e.childChange(c, d.getId());\n    }\n  }, {\n    key: \"getName\",\n    value: function getName() {\n      return 'generic';\n    }\n  }, {\n    key: \"getType\",\n    value: function getType() {\n      return 'generic';\n    }\n  }, {\n    key: \"getId\",\n    value: function getId() {\n      return this._id || this.setId(), this._id;\n    }\n  }, {\n    key: \"setId\",\n    value: function setId(a) {\n      var b;\n      a === UNDEF && (b = this.getType() + UNDERSCORE + this.getName(), !idCounterStore[b] && (idCounterStore[b] = 1), a = b + UNDERSCORE + idCounterStore[b], idCounterStore[b] += 1), this._id = a;\n    }\n  }, {\n    key: \"iterateComponents\",\n    value: function iterateComponents(a) {\n      var b = function b(c, d, e) {\n        var f = a(c, d, e);\n        !1 !== f && c._mapChildren && c._mapChildren(b);\n      };\n\n      this._mapChildren(b);\n    }\n  }, {\n    key: \"getFromEnv\",\n    value: function getFromEnv(a) {\n      return a ? this._env[a] : this._env;\n    }\n  }, {\n    key: \"addToEnv\",\n    value: function addToEnv(a, b) {\n      a && (this._env[a] = b);\n    }\n  }, {\n    key: \"deleteFromEnv\",\n    value: function deleteFromEnv(a) {\n      delete this._env[a];\n    }\n  }, {\n    key: \"_updateParentEnv\",\n    value: function _updateParentEnv() {\n      var a,\n          b,\n          c,\n          d,\n          e = this.getLinkedParent(),\n          f = this._env;\n\n      if (e) {\n        if (a = e.getFromEnv(), b = function b() {}, b.prototype = a, b.prototype.constructor = b, c = new b(), f) for (d in f) {\n          f.hasOwnProperty(d) && (c[d] = f[d]);\n        }\n        this._env = c, this._mapChildren(function (a) {\n          a._updateParentEnv && a._updateParentEnv();\n        });\n      }\n    }\n  }, {\n    key: \"addJob\",\n    value: function addJob(a, b, c, d) {\n      var e = this;\n      e._jobList[a] = e._jobList[a] ? schedular.updateJob(e._jobList[a], b, c, d) : schedular.addJob(b, c, d);\n    }\n  }, {\n    key: \"removeJob\",\n    value: function removeJob(a) {\n      var b = this._jobList[a];\n      b && (schedular.removeJob(b), delete this._jobList[a]);\n    }\n  }, {\n    key: \"removeAllJobs\",\n    value: function removeAllJobs() {\n      var a,\n          b = this._jobList;\n\n      for (a in b) {\n        b.hasOwnProperty(a) && (schedular.removeJob(b[a]), delete b[name]);\n      }\n    }\n  }, {\n    key: \"asyncDraw\",\n    value: function asyncDraw() {\n      var a = this;\n      a.addJob('draw', a.__drawJob, priorityList && priorityList.draw, asyncDrawOptions);\n    }\n  }, {\n    key: \"syncDraw\",\n    value: function syncDraw() {\n      var a = this;\n      a.fireEvent('predraw'), a.removeJob('draw'), a.getState('removed') ? a.removingDraw() : a.draw && a.draw(), a.addExtEventListener('animationComplete', a.__remove, a.getFromEnv('animationManager')), a.childrenSyncDraw(), a.setState('dirty', !1), a.setState('parentChanged', !1), a.addJob('draw-complete', function () {\n        a.fireEvent('drawn');\n      }, priorityList.instant);\n    }\n  }, {\n    key: \"updateVisual\",\n    value: function updateVisual() {\n      var a = this;\n      a.fireEvent('beforevisualupdate'), a.removeJob('visualupdate'), a.manageSpace && a.manageSpace(), a.prepareAttributes(), a.syncDraw(), a.fireEvent('visualupdated');\n    }\n  }, {\n    key: \"childrenSyncDraw\",\n    value: function childrenSyncDraw() {\n      this._mapChildren(function (a) {\n        a && a.draw && a.syncDraw();\n      });\n    }\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(a, b, c) {\n      var d,\n          f = this;\n      return !!(a && a.toLowerCase && (a = a.toLowerCase(), addListener(a, b, f, c))) && (isInterActiveEvt(a) && (d = getListeners(a, f), d && 1 === d.length) ? (f._middleListeners || (f._middleListeners = {}), f._middleListeners[a] || (f._middleListeners[a] = function (b) {\n        f.fireEvent(a, UNDEF, UNDEF, UNDEF, b);\n      }), !0) : b);\n    }\n  }, {\n    key: \"removeEventListener\",\n    value: function removeEventListener(a, b) {\n      var c,\n          d = this;\n      if (a && a.toLowerCase && (a = a.toLowerCase(), removeListener(a, b, d), isInterActiveEvt(a) && (c = getListeners(a, d), c && 0 === c.length && d._middleListeners && d._middleListeners[a]))) return !0;\n    }\n  }, {\n    key: \"fireEvent\",\n    value: function fireEvent(a, b, c, d, e) {\n      triggerEvent(a, this, b, e, c, d);\n    }\n  }, {\n    key: \"addExtEventListener\",\n    value: function addExtEventListener(a, b, c) {\n      var d = this;\n      return !!(c && c.addEventListener && c.addEventListener(a, b)) && (d._extListeners[a] || (d._extListeners[a] = []), d._extListeners[a].push({\n        fn: b,\n        component: c\n      }), b);\n    }\n  }, {\n    key: \"removeExtEventListener\",\n    value: function removeExtEventListener(a, b, c) {\n      var d,\n          e,\n          f,\n          g = this;\n      if (c && c.addEventListener && g._extListeners && g._extListeners[a]) for (f = g._extListeners[a], e = f.length, d = e - 1; 0 <= d; d -= 1) {\n        if (f[d] && f[d].fn === b && f[d].component === c) return c.removeEventListener(a, b), void f.splice(d, 1);\n      }\n    }\n  }, {\n    key: \"_setLinkedParent\",\n    value: function _setLinkedParent(a) {\n      var b = this._linkedParent;\n      this._linkedParent = a, b !== a && (this.setState('parentChanged', !0), b && this.fireEvent('parentdetached', {\n        oldParent: b\n      }), a && this.fireEvent('parentAttached', {\n        newParent: a\n      })), this._updateParentEnv && this._updateParentEnv();\n    }\n  }, {\n    key: \"getLinkedParent\",\n    value: function getLinkedParent() {\n      return this._linkedParent;\n    }\n  }, {\n    key: \"setLinkedItem\",\n    value: function setLinkedItem(a, b) {\n      this.linkedItems || (this.linkedItems = {}), (a !== UNDEF || b !== UNDEF) && (this.linkedItems[a] = b);\n    }\n  }, {\n    key: \"getLinkedItem\",\n    value: function getLinkedItem(a) {\n      if (this.linkedItems) return a === UNDEF ? this.linkedItems : this.linkedItems[a];\n    }\n  }, {\n    key: \"removeLinkedItem\",\n    value: function removeLinkedItem(a) {\n      this.linkedItems && this.linkedItems[a] && delete this.linkedItems[a];\n    }\n  }, {\n    key: \"detachChild\",\n    value: function detachChild(a) {\n      var b,\n          c = this;\n      return a === UNDEF ? UNDEF : (c._searchChildren(a, function (a, d, e) {\n        e && e.constructor === Array ? b = e.splice(d, 1)[0] : (b = e[a], delete e[a]), b._setLinkedParent(UNDEF), c.fireEvent('childdetached', {\n          detachedChild: b\n        });\n      }), b);\n    }\n  }, {\n    key: \"_mapChildren\",\n    value: function _mapChildren(a, b) {\n      b ? _mapSubFnBackward(this.getChildren(), a) : _mapSubFnForward(this.getChildren(), a);\n    }\n  }, {\n    key: \"_dispose\",\n    value: function _dispose() {\n      var a,\n          b,\n          c,\n          d,\n          e = this;\n\n      if (e && e !== window && !0 !== e._disposing) {\n        if (e._disposing = !0, e.fireEvent('beforeremove'), a = e.getLinkedParent(), a && a.detachChild && !a._disposing && a.detachChild(this.getId()), e._extListeners) for (c in e._extListeners) {\n          for (d = e._extListeners[c], b = d.length - 1; 0 <= b; b--) {\n            d[b].component && d[b].component.addEventListener && d[b].component.removeEventListener(c, d[b].fn);\n          }\n        }\n        return e.removeAllJobs(), !0;\n      }\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(a) {\n      var b,\n          c = this,\n          d = a && a.instant;\n      c.setState('removed', !0), b = c.getChildren(), b && c._mapChildren(function (b) {\n        b && b.remove && b.remove(a);\n      }, !0), d && c._dispose();\n    }\n  }, {\n    key: \"setState\",\n    value: function setState(a, b) {\n      this._state[a] = b;\n    }\n  }, {\n    key: \"getState\",\n    value: function getState(a) {\n      return this._state && this._state[a];\n    }\n  }, {\n    key: \"registerFactory\",\n    value: function registerFactory(a, b, c) {\n      if (this._factoriyNames[a]) for (var _b = 0, _c = this._factories.length, d = !1; _b < _c && !d; _b += 1) {\n        this._factories[_b].name === a && (this._factories.splice(_b, 1), d = !0);\n      }\n      this._factories.push({\n        name: a,\n        factory: b,\n        dep: c\n      }), this._factoriyNames[a] = !0;\n    }\n  }, {\n    key: \"deregisterFactory\",\n    value: function deregisterFactory(a) {\n      if (this._factoriyNames[a]) return delete this._factoriyNames[a], this._factories.splice(this._factories.findIndex(function (b) {\n        return b.name === a;\n      }), 1)[0].factory;\n    }\n  }, {\n    key: \"invokeFactories\",\n    value: function invokeFactories() {\n      var a,\n          b = this,\n          c = b._factoriyNames,\n          d = {},\n          e = b._factories,\n          f = e.length + 1,\n          g = function g(e) {\n        var f;\n        e.dep && e.dep.length && e.dep.forEach(function (a) {\n          f = c[a] && !d[a];\n        }), f ? a.push(e) : (e.factory(b), d[e.name] = !0);\n      };\n\n      for (; e.length && e.length < f;) {\n        a = [], e.forEach(g), f = e.length, e = a;\n      }\n\n      e.length && e.forEach(function (a) {\n        return a.factory(b);\n      }), this.fireEvent('factoriesinvoked', {});\n    }\n  }]);\n\n  return ComponentBase;\n}();\n\nexport default ComponentBase;\nexport { removeAllEventsFromGraphic, addAllEventsOnGraphic, _mapSubFnForward };","map":null,"metadata":{},"sourceType":"module"}